!function(c){"use strict";c.qs=function(e,t){return(t||document).querySelector(e)},c.qsa=function(e,t){return(t||document).querySelectorAll(e)},c.$on=function(e,t,r,o){e.addEventListener(t,r,!!o)},c.$delegate=function(o,n,e,a){var t="blur"===e||"focus"===e;c.$on(o,e,function(e){var t=e.target,r=c.qsa(n,o);0<=Array.prototype.indexOf.call(r,t)&&a.call(t,e)},t)},c.$parent=function(e,t){if(e.parentNode)return e.parentNode.tagName.toLowerCase()===t.toLowerCase()?e.parentNode:c.$parent(e.parentNode,t)},NodeList.prototype.forEach=Array.prototype.forEach}(window);

!function(t){"use strict";function o(t,o){if(o=o||function(){},this._dbName=t,!localStorage[t]){localStorage[t]=JSON.stringify({todos:[]})}o.call(this,JSON.parse(localStorage[t]))}o.prototype.find=function(a,t){if(t){var o=JSON.parse(localStorage[this._dbName]).todos;t.call(this,o.filter(function(t){for(var o in a)if(a[o]!==t[o])return!1;return!0}))}},o.prototype.findAll=function(t){(t=t||function(){}).call(this,JSON.parse(localStorage[this._dbName]).todos)},o.prototype.save=function(t,o,a){var r=JSON.parse(localStorage[this._dbName]),i=r.todos;if(o=o||function(){},a){for(var e=0,l=i.length;e<l;e++)if(i[e].id===a){for(var n in t)i[e][n]=t[n];break}localStorage[this._dbName]=JSON.stringify(r),o.call(this,i)}else{var s="",f="0123456789";if(0<i.length)for(var c=!0;!0===c;){for(e=0;e<6;e++)s+=f.charAt(Math.floor(Math.random()*f.length));for(e=0,l=i.length;e<l;e++){if(i[e].id===s){c=!0;break}c=!1}}else for(e=0;e<6;e++)s+=f.charAt(Math.floor(Math.random()*f.length));t.id=parseInt(s),i.push(t),localStorage[this._dbName]=JSON.stringify(r),o.call(this,[t])}},o.prototype.remove=function(t,o){for(var a=JSON.parse(localStorage[this._dbName]),r=a.todos,i=0,e=r.length;i<e;i++)if(r[i].id==t){r.splice(i,1);break}localStorage[this._dbName]=JSON.stringify(a),o.call(this,r)},o.prototype.drop=function(t){var o={todos:[]};localStorage[this._dbName]=JSON.stringify(o),t.call(this,o.todos)},t.app=t.app||{},t.app.Store=o}(window);

!function(t){"use strict";function o(t){this.storage=t}o.prototype.create=function(t,o){o=o||function(){};var e={title:(t=t||"").trim(),completed:!1};this.storage.save(e,o)},o.prototype.read=function(t,o){var e=typeof t;if(o=o||function(){},"function"==e)return o=t,this.storage.findAll(o);"string"==e||"number"==e?(t=parseInt(t,10),this.storage.find({id:t},o)):this.storage.find(t,o)},o.prototype.update=function(t,o,e){this.storage.save(o,e,t)},o.prototype.remove=function(t,o){this.storage.remove(t,o)},o.prototype.removeAll=function(t){this.storage.drop(t)},o.prototype.getCount=function(o){var e={active:0,completed:0,total:0};this.storage.findAll(function(t){t.forEach(function(t){t.completed?e.completed++:e.active++,e.total++}),o(e)})},t.app=t.app||{},t.app.Model=o}(window);

!function(e){"use strict";function n(e){return t[e]}var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},i=/[&<>"'`]/g,d=new RegExp(i.source);function l(){this.defaultTemplate='<li data-id="{{id}}" class="{{completed}}"><div class="view"><input class="toggle" type="checkbox" {{checked}}><label>{{title}}</label><button class="destroy"></button></div></li>'}l.prototype.show=function(e){for(var t,l="",o=0,c=e.length;o<c;o++){var p=this.defaultTemplate,r="",a="";e[o].completed&&(r="completed",a="checked"),l+=p=(p=(p=(p=p.replace("{{id}}",e[o].id)).replace("{{title}}",(t=e[o].title)&&d.test(t)?t.replace(i,n):t)).replace("{{completed}}",r)).replace("{{checked}}",a)}return l},l.prototype.itemCounter=function(e){return"<strong>"+e+"</strong> item"+(1===e?"":"s")+" left"},l.prototype.clearCompletedButton=function(e){return 0<e?"Supprimer les taches complete":""},e.app=e.app||{},e.app.Template=l}(window);

!function(e){"use strict";function t(e){this.template=e,this.ENTER_KEY=13,this.ESCAPE_KEY=27,this.$todoList=qs(".todo-list"),this.$todoItemCounter=qs(".todo-count"),this.$clearCompleted=qs(".clear-completed"),this.$main=qs(".main"),this.$footer=qs(".footer"),this.$toggleAll=qs(".toggle-all"),this.$newTodo=qs(".new-todo")}t.prototype._removeItem=function(e){var t=qs('[data-id="'+e+'"]');t&&this.$todoList.removeChild(t)},t.prototype._clearCompletedButton=function(e,t){this.$clearCompleted.innerHTML=this.template.clearCompletedButton(e),this.$clearCompleted.style.display=t?"block":"none"},t.prototype._setFilter=function(e){qs(".filters .selected").className="",qs('.filters [href="#/'+e+'"]').className="selected"},t.prototype._elementComplete=function(e,t){var i=qs('[data-id="'+e+'"]');i&&(i.className=t?"completed":"",qs("input",i).checked=t)},t.prototype._editItem=function(e,t){var i=qs('[data-id="'+e+'"]');if(i){i.className=i.className+" editing";var o=document.createElement("input");o.className="edit",i.appendChild(o),o.focus(),o.value=t}},t.prototype._editItemDone=function(e,t){var i=qs('[data-id="'+e+'"]');if(i){var o=qs("input.edit",i);i.removeChild(o),i.className=i.className.replace("editing",""),qsa("label",i).forEach(function(e){e.textContent=t})}},t.prototype.render=function(e,t){var i=this;({showEntries:function(){i.$todoList.innerHTML=i.template.show(t)},removeItem:function(){i._removeItem(t)},updateElementCount:function(){i.$todoItemCounter.innerHTML=i.template.itemCounter(t)},clearCompletedButton:function(){i._clearCompletedButton(t.completed,t.visible)},contentBlockVisibility:function(){i.$main.style.display=i.$footer.style.display=t.visible?"block":"none"},toggleAll:function(){i.$toggleAll.checked=t.checked},setFilter:function(){i._setFilter(t)},clearNewTodo:function(){i.$newTodo.value=""},elementComplete:function(){i._elementComplete(t.id,t.completed)},editItem:function(){i._editItem(t.id,t.title)},editItemDone:function(){i._editItemDone(t.id,t.title)}})[e]()},t.prototype._itemId=function(e){var t=$parent(e,"li");return parseInt(t.dataset.id,10)},t.prototype._bindItemEditDone=function(e){var t=this;$delegate(t.$todoList,"li .edit","blur",function(){this.dataset.iscanceled||e({id:t._itemId(this),title:this.value})}),$delegate(t.$todoList,"li .edit","keypress",function(e){e.keyCode===t.ENTER_KEY&&this.blur()})},t.prototype._bindItemEditCancel=function(t){var i=this;$delegate(i.$todoList,"li .edit","keyup",function(e){e.keyCode===i.ESCAPE_KEY&&(this.dataset.iscanceled=!0,this.blur(),t({id:i._itemId(this)}))})},t.prototype.bind=function(e,t){var i=this;"newTodo"===e?$on(i.$newTodo,"change",function(){t(i.$newTodo.value)}):"removeCompleted"===e?$on(i.$clearCompleted,"click",function(){t()}):"toggleAll"===e?$on(i.$toggleAll,"click",function(){t({completed:this.checked})}):"itemEdit"===e?$delegate(i.$todoList,"li label","dblclick",function(){t({id:i._itemId(this)})}):"itemRemove"===e?$delegate(i.$todoList,".destroy","click",function(){t({id:i._itemId(this)})}):"itemToggle"===e?$delegate(i.$todoList,".toggle","click",function(){t({id:i._itemId(this),completed:this.checked})}):"itemEditDone"===e?i._bindItemEditDone(t):"itemEditCancel"===e&&i._bindItemEditCancel(t)},e.app=e.app||{},e.app.View=t}(window);

!function(e){"use strict";function t(e,t){var i=this;i.model=e,i.view=t,i.view.bind("newTodo",function(e){i.addItem(e)}),i.view.bind("itemEdit",function(e){i.editItem(e.id)}),i.view.bind("itemEditDone",function(e){i.editItemSave(e.id,e.title)}),i.view.bind("itemEditCancel",function(e){i.editItemCancel(e.id)}),i.view.bind("itemRemove",function(e){i.removeItem(e.id)}),i.view.bind("itemToggle",function(e){i.toggleComplete(e.id,e.completed)}),i.view.bind("removeCompleted",function(){i.removeCompletedItems()}),i.view.bind("toggleAll",function(e){i.toggleAll(e.completed)})}t.prototype.setView=function(e){var t=e.split("/")[1]||"";this._updateFilterState(t)},t.prototype.showAll=function(){var t=this;t.model.read(function(e){t.view.render("showEntries",e)})},t.prototype.showActive=function(){var t=this;t.model.read({completed:!1},function(e){t.view.render("showEntries",e)})},t.prototype.showCompleted=function(){var t=this;t.model.read({completed:!0},function(e){t.view.render("showEntries",e)})},t.prototype.addItem=function(e){var t=this;""!==e.trim()&&t.model.create(e,function(){t.view.render("clearNewTodo"),t._filter(!0)})},t.prototype.editItem=function(t){var i=this;i.model.read(t,function(e){i.view.render("editItem",{id:t,title:e[0].title})})},t.prototype.editItemSave=function(e,t){var i=this;0!==(t=t.trim()).length?i.model.update(e,{title:t},function(){i.view.render("editItemDone",{id:e,title:t})}):i.removeItem(e)},t.prototype.editItemCancel=function(t){var i=this;i.model.read(t,function(e){i.view.render("editItemDone",{id:t,title:e[0].title})})},t.prototype.removeItem=function(e){var t=this;t.model.remove(e,function(){t.view.render("removeItem",e)}),t._filter()},t.prototype.removeCompletedItems=function(){var t=this;t.model.read({completed:!0},function(e){e.forEach(function(e){t.removeItem(e.id)})}),t._filter()},t.prototype.toggleComplete=function(e,t,i){var o=this;o.model.update(e,{completed:t},function(){o.view.render("elementComplete",{id:e,completed:t})}),i||o._filter()},t.prototype.toggleAll=function(t){var i=this;i.model.read({completed:!t},function(e){e.forEach(function(e){i.toggleComplete(e.id,t,!0)})}),i._filter()},t.prototype._updateCount=function(){var t=this;t.model.getCount(function(e){t.view.render("updateElementCount",e.active),t.view.render("clearCompletedButton",{completed:e.completed,visible:0<e.completed}),t.view.render("toggleAll",{checked:e.completed===e.total}),t.view.render("contentBlockVisibility",{visible:0<e.total})})},t.prototype._filter=function(e){var t=this._activeRoute.charAt(0).toUpperCase()+this._activeRoute.substr(1);this._updateCount(),!e&&"All"===this._lastActiveRoute&&this._lastActiveRoute===t||this["show"+t](),this._lastActiveRoute=t},t.prototype._updateFilterState=function(e){""===(this._activeRoute=e)&&(this._activeRoute="All"),this._filter(),this.view.render("setFilter",e)},e.app=e.app||{},e.app.Controller=t}(window);

!function(){"use strict";var e=new function(e){this.storage=new app.Store(e),this.model=new app.Model(this.storage),this.template=new app.Template,this.view=new app.View(this.template),this.controller=new app.Controller(this.model,this.view)}("todos-vanillajs");function t(){e.controller.setView(document.location.hash)}$on(window,"load",t),$on(window,"hashchange",t)}();